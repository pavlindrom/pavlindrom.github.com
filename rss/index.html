<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[Pavlo Grijincu]]></title><description><![CDATA[Yet another beginner's programming adventures.]]></description><link>/</link><generator>Ghost 0.11</generator><lastBuildDate>Sat, 28 Jan 2017 23:49:26 GMT</lastBuildDate><atom:link href="/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Running a Blog for (Almost) Nothing]]></title><description><![CDATA[<p>Blogging has many benefits, I hear. I don't need to hear many to be sold - I need a low price tag. The blogging cost isn't in the time it takes to write an article, not even that half of that time is spent writing the first few sentences, it's</p>]]></description><link>/running-a-blog-for-almost-nothing/</link><guid isPermaLink="false">744716aa-c37b-48b0-9e0e-32d700a1a547</guid><category><![CDATA[Getting Started]]></category><category><![CDATA[Hosting]]></category><dc:creator><![CDATA[Pavlo Grijincu]]></dc:creator><pubDate>Sat, 21 Jan 2017 04:57:42 GMT</pubDate><content:encoded><![CDATA[<p>Blogging has many benefits, I hear. I don't need to hear many to be sold - I need a low price tag. The blogging cost isn't in the time it takes to write an article, not even that half of that time is spent writing the first few sentences, it's for the machine that must stay up at all times for the visitor.</p>

<p>When you start a blog you agree to obey the unwritten rule of the internet - to never be unavailable. You are not the corner shop that bars the windows at precisely 8 PM, a sign even to the customer with the unexpected emergency. They'd have to seek you personally to buy your services. On the internet you are a content distributor that must be ready to service requests at all times, whether here or half a world away.</p>

<p>For a first blog I desired a simple solution so that I wouldn't give up before reaching the finish line. This is what I reckon to be the simplest solution to the problem I sought to solve.</p>

<h3 id="buildingblocks">Building Blocks</h3>

<p>I pieced this blog together from whatever I had lying around, and the things I had a prior knowledge of. This should not be followed as a recipe, but as inspiration.</p>

<h4 id="araspberrypi">A Raspberry Pi</h4>

<p>The first piece of the setup is a Raspberry Pi 3 I purchased a few months prior. I got it for someone else's school project, since they had no intention to hold onto such a thing after the assignment was over. You can't judge a designer for being a little too cool towards hardware, or for hating the LED blinker assignment.</p>

<p>I intend to host the website on the Pi locally, to set up the blog, write the articles, and fiddle with the design of the blog on it. It is more than sufficient to sustain the load of one user, once in a while. The files will then be stored and served cold to the world.</p>

<p>Setting up the Pi is <a href="https://www.raspberrypi.org/documentation/setup/">pretty simple</a>. Once you have it running, connect it to wifi, and then you can easily SSH to make any changes.</p>

<p>I suggest getting Avahi installed on the Pi - it lets me connect to the Pi using <code>{hostname}.local</code> just by running <code>sudo apt-get install avahi-daemon</code>, and having Apple's <a href="http://www.howtogeek.com/167190/how-and-why-to-assign-the-.local-domain-to-your-raspberry-pi/">Bonjour software installed</a>. <em>Also, I'm glad I found about this before attempting to create a static IP, and learn of <a href="http://raspberrypi.stackexchange.com/questions/39785/dhcpcd-vs-etc-network-interfaces">all the ways</a> it doesn't work <a href="https://www.raspberrypi.org/forums/viewtopic.php?t=110557&amp;p=762332">just right</a> on the Pi</em>. I'd still like the 4 hours back, though.</p>

<h4 id="theghostpublishingplatform">The Ghost Publishing Platform</h4>

<p>I decided to use <a href="https://ghost.org/"><em>Ghost</em></a> to serve the content, simply because I heard about it before. Ghost is still in development, so it may not be the right solution for you. It is free if you host it yourself.</p>

<p>Ghost runs on node.js LTS, so make sure you have the right version installed - the latest version will probably give you trouble. The commands listed <a href="https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions">here</a> have worked for me.</p>

<p>Ghost has a <a href="http://support.ghost.org/getting-started/">getting started</a> guide. Make it <a href="https://www.ghostforbeginners.com/keep-ghost-running-with-pm2/">autostart with PM2</a>. Use <a href="http://support.ghost.org/basic-nginx-config/">Nginx to proxy</a> those pages to the internal network. Finally, update the Ghost URL in config.js to the internally accessible URL - otherwise the links will point to localhost.</p>

<h4 id="githubpages">GitHub Pages</h4>

<p>GitHub offers free static file hosting to anyone through their GitHub Pages. It is for open source projects, and your own personal websites. No merchandising. You get one just by creating a free account. It's easy to <a href="https://help.github.com/articles/configuring-a-publishing-source-for-github-pages/">get started</a>, and pretty easy to <a href="https://help.github.com/articles/quick-start-setting-up-a-custom-domain/">use a custom domain</a> if you're so inclined. You will need to complement this update with some changes at the registrar, and Google should help with that.</p>

<h4 id="bitbucket">BitBucket</h4>

<p>Now onto another git repository, which I want to use for <a href="https://www.ghostforbeginners.com/backup-ghost/">backing up</a> the entire blog. I plan to create a backup everytime I publish something to GitHub Pages, and I want the backup to be private. <a href="https://bitbucket.org/">BitBucket</a> offers unlimited private repositories even on the free plan.</p>

<h3 id="alltogethernow">All Together Now</h3>

<p>The solution isn't yet complete. The website needs to be downloaded, pushed to GitHub Pages, and backed up to BitBucket. All these things are pretty easy on Linux. I never been so fond of Linux.</p>

<h4 id="makeastaticcopy">Make A Static Copy</h4>

<p>Linux has <code>wget</code> which downloads a file. With a few flags, I can make a copy of the website locally:  </p>

<pre><code>wget -rp --content-disposition http://{hostname}.local  
</code></pre>

<p>That will follow and download all links recursively (<code>-r</code>), all required resource, such as CSS and JavaScript files (<code>-p</code>), and save the Content-Disposition MIME type (<code>--content-disposition</code>) if they are on the domain <code>http://{hostname}.local</code>.</p>

<p>I hope that the Content-Disposition will be handled correctly, GitHub claims they <a href="https://help.github.com/articles/mime-types-on-github-pages/">support the feature</a>, with Nginx in the text on the page. I don't know how to test it, and it hasn't broken the page in browsing the website.</p>

<p>Once this command finishes, there is a folder <code>{hostname}.local</code> in the current directory (I decided to do it under <code>/var/www/ghost</code>).</p>

<h4 id="fixfilenames">Fix File Names</h4>

<p>Ghost requests CSS and JavaScript pages using a querystring version parameter to bust caches. They can be removed with:  </p>

<pre><code>find ./{hostname}.local -name '*\?*' -type f | while read -r name  
do  
    mv -i "$name" "${name%\?*}"
done  
</code></pre>

<h4 id="makelinksrelative">Make Links Relative</h4>

<p>Some links are also pointing to <code>http://{hostname}.local</code>, which is only accessible from the local network. Changing all links to be relative will allow me to host it anywhere I please. Here's how:  </p>

<pre><code>find ./{hostname}.local -type f -exec sed -i 's/http:\/\/{hostname}\.local\/\?/\//g' {} +  
</code></pre>

<p>You can easily change it to a custom domain instead of relative links. There may be a reason to do that, and I don't know it.</p>

<h4 id="publishblog">Publish Blog</h4>

<p>Now that the files are correctly formatted, and linked, we can publish. The first step is to copy the static pages into the local GitHub Pages repository, then delete (outright move didn't work, for unknown reasons):  </p>

<pre><code>cp -r ./{hostname}.local/* /usr/src/{username}.github.com  
rm -rf ./{hostname}.local  
</code></pre>

<p>Then commit the changes:  </p>

<pre><code>cd /usr/src/{username}.github.com  
git add -A  
git commit -m"Blog publish"  
git push  
</code></pre>

<p>A great side effect about this is that no links will ever be broken. The other side of the coin is that when URLs change formats, there is no easy way to redirect from the old to the new.</p>

<h4 id="backup">Backup</h4>

<p>For backing up it is recommended that the blog is stopped to avoid database corruption. This is pretty straight forward:  </p>

<pre><code>cd /var/www/ghost  
pm2 stop ghost  
git add -A  
git commit -m"Backup on publish"  
git push  
pm2 start ghost  
</code></pre>

<h3 id="conclusion">Conclusion</h3>

<p>That is it. The setup has its challenges, and it has been a good source of confusion as I worked through it. I could not detail all the things that I have come across as I worked, primarily because I haven't kept a list, but also since all the solutions to the problems are easy to find with Google, or a comparable web search engine.</p>

<p>The script to take the website from the local host to the internet is then straightforward. I have modified it one bit - instead of using a generic commit message (it doesn't look in the log), I'm able to send a custom commit message to the script. And that's a significant improvement.</p>

<p>Speaking of the script, here it is, ready for you to replace <code>{hostname}</code> and <code>{username}</code> with the correct values, and use to share your insights with the world at large:  </p>

<pre><code># Create static copy
wget -rp --content-disposition http://{hostname}.local

# Fix file names
find ./{hostname}.local -name '*\?*' -type f | while read -r name  
do  
    mv -i "$name" "${name%\?*}"
done

# Update URLs
find ./{hostname}.local -type f -exec sed -i 's/http:\/\/{hostname}\.local\/\?/\//g' {} +

# Publish blog
cp -r ./{hostname}.local/* /usr/src/{username}.github.com  
rm -rf ./{hostname}.local  
cd /usr/src/{username}.github.com  
git add -A  
git commit -m"$1"  
git push

# Backup entire blog
cd /var/www/ghost  
runuser -l pi -c 'pm2 stop ghost'  
git add -A  
git commit -m"$1"  
git push  
runuser -l pi -c 'pm2 start ghost'  
</code></pre>

<p>The final step is to make the file executable with <code>sudo chmod +x ./publish.sh</code>. Now you can run it as <code>sudo sh ./publish.sh "Commit message"</code>.</p>

<p>I haven't grasped permissions in Linux yet, and sudo still solves all my problems - except where it doesn't. In the above script I am switching the user back from <code>root</code> to <code>pi</code> (or whatever other user you have created for the purpose of running ghost), since pm2 doesn't find the requested process if it's running as root. The quick and dirty solution isn't pretty, but it's a solution. </p>

<h4 id="advantages">Advantages</h4>

<ul>
<li><strong>Cost</strong>: hosting is free. The only thing I pay for is the domain.</li>
<li><strong>Security</strong>: without a password-protected area, I don't have to worry about someone gaining access to the admin portal and defacing the website.</li>
<li><strong>Change Tracking</strong>: I mean, isn't it great that I can say I updated this blog post, and have a link that shows all changes? Yes, it is. Thanks, GitHub Pages.</li>
</ul>

<h4 id="disadvantages">Disadvantages</h4>

<ul>
<li><strong>Added Complexity</strong>: it's not an update it and forget it workflow. After every update I need to remember to publish.</li>
<li><strong>Content Frozen</strong>: I can't update the blog from anywhere, I need to be able to access the home network for every update. Urgent fixes can be made by editing the HTML, but the same change must be made in ghost admin once I return home.</li>
<li><strong>Security</strong>: By using GitHub Pages with a custom domain I don't have SSL/TLS to secure the data in passing. Not a huge issue since there are no password-protected areas, but it's still not desirable.</li>
<li><strong>Dynamic Content</strong>: Since I'm saving a static copy of the website I can't rely on endpoints to receive data. I'd have to use Amazon's Lambdas, or Azure's Functions (which I wouldn't mind playing with).</li>
</ul>

<h4 id="lookingforward">Looking Forward</h4>

<p>There are a number of things that can be improved, and the biggest that I can see is the need to <code>sudo</code> everything, except where I can't, so I need to <em>unsudo</em> for a few lines. </p>

<p>I'm also thinking of eventually moving the hosting to Amazon S3. That way I will be able to get a <a href="https://aws.amazon.com/certificate-manager/pricing/">free SSL certificate</a>, and the cost of hosting a static website should stay low - at a few cents a month.</p>

<h3 id="finalremarks">Final Remarks</h3>

<p><img src="/content/images/2017/01/WP_20170108_14_21_58_Pro.jpg" alt="Wing it."></p>

<p>I winged it - and so can you. With just one blog post under my wings I can tell you that there's a great reason to start blogging - to learn how much more there is to learn.</p>

<p>And, if at any time you have shaken your head at my setup - let me know in the comments area. All others with opinions on the topic, feel free to do the same.</p>]]></content:encoded></item></channel></rss>